# Readme Tema 1 PCOM Dumitru Nicolae-Luca 322CB

## Scurta descriere

In aceasta tema am implementat o parte din logica unui router, anume partea de dataplane.

## Etapele de rezolvare

- Parsez informatia primita si o pun intr-o structura cu care sa pot lucra mai usor. In acest
caz am folosit structura packet, in care tin diferiti pointeri pentru usurarea lucrului

- Impart pachetele in 2 categorii

## Pachete IP

- Verific daca au lungimea minima corecta
- Verific daca eu (routerul) sunt destinatia (daca dest_addr este my_ip)
    - Daca eu sunt destinatia, trimit un pachet cu ICMP de tip Reply (in cazul in care pachetul primit este de tipul ICMP Echo Request)
- Verific checksum:
    - Setez checksum pe 0
    - Calculez checksum
    - Compar cu ce era inainte
- Decrementez TTL
    - Daca TTL este <= 1, trimit un ICMP de tip Time Exceeded
- Fac Longest Prefix Match si gasesc o structura route_table_entry care sa contina toate informatiile necesare pentru trimiterea pachetului
    - Pentru a respecta cerinta de cautare mai buna de liniar, am efectuat o cautare liniara. Pentru acest lucru am sortat initial vectorul de intrari descrescator dupa masca si crescator dupa prefix. Caut la rand la fiecare masca (de la cea mai mare la cea mai mica) prefixul corespunzator
    - Daca nu gasesc o astfel de intrare, trimit un pachet ICMP Destination Unreachable
- Recalculez checksum
- Setez corect adresele MAC destinatie si sursa
    - Caut in cache adresa MAC a lui next_hop
        - Daca am gasit in cache aceasta adresa, completez pachetul si il trimit
        - Daca nu am gasit in cache adresa, fac o clona a pachetului pe care vreau sa il trimit (impreuna cu alte informatii despre el) si le pun intr-o coada. Dupa aceasta trimit un ARP REQUEST pentru a obtine adresa MAC necesara. Acest lucru nu este blocant (Am pus pachetul in coada deci pot sa continui sa trimit si sa primesc pachete pana cand o sa primesc acel ARP REPLY). Important de mentionat este ca, inainte sa trimit ARP REQUEST, verific daca mai exista deja in coada alte pachete care asteapta acelasi ARP REPLY (tocmai pentru a nu trimite requesturi inutile)

## Pachete ARP

- Verific daca au lungimea minima corecta
- Verific daca pachetul ARP primit este de tip REQUEST
    - Daca eu (routerul) sunt destinatia, trimit un ARP REPLY (inversez adresele corespunzatoare)
- Daca am primit un pachet de tipul ARP REPLY
    - Adaug in cache adresa primita (datorita faptului ca trimit ARP REQUEST doar atunci cand este nevoie, in cache nu o sa existe duplicate)
    - Caut in coada toate pachetele care asteptau acest pachet Reply
    - Completez fiecare pachet cu informatia care lipsea si le trimit
